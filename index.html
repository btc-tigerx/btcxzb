<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>₿ BTC综合指标系统 - 付费订阅版</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>₿</text></svg>">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1e1b4b 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        /* 登录界面 */
        .login-box {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
            max-width: 400px;
            margin: 100px auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 60px rgba(255, 153, 0, 0.1);
        }

        .btc-logo {
            text-align: center;
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #a0aec0;
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e0;
            font-size: 0.9rem;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 10px;
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #f7931a;
            background: rgba(30, 41, 59, 0.7);
            box-shadow: 0 0 15px rgba(247, 147, 26, 0.2);
        }

        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            color: #ffffff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.3);
        }

        .btn-secondary {
            background: rgba(30, 41, 59, 0.5);
            color: #cbd5e0;
            border: 1px solid rgba(255, 153, 0, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(30, 41, 59, 0.7);
            border-color: #f7931a;
        }

        /* 付费页面 */
        .payment-page {
            max-width: 800px;
            margin: 50px auto;
        }

        .payment-card {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .payment-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .payment-header h2 {
            font-size: 2rem;
            color: #f7931a;
            margin-bottom: 10px;
        }

        .payment-header p {
            color: #a0aec0;
        }

        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .pricing-item {
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .pricing-item:hover {
            border-color: #f7931a;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.2);
        }

        .pricing-item.recommended {
            border-color: #f7931a;
            background: rgba(247, 147, 26, 0.1);
        }

        .pricing-badge {
            display: inline-block;
            background: #f7931a;
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .pricing-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 15px;
        }

        .pricing-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: #f7931a;
            margin-bottom: 5px;
        }

        .pricing-period {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .pricing-save {
            color: #10b981;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .wallet-section {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .wallet-title {
            font-size: 1.1rem;
            color: #f7931a;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .wallet-address {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .wallet-address input {
            flex: 1;
            background: transparent;
            border: none;
            color: #10b981;
            font-family: monospace;
            font-size: 0.95rem;
        }

        .btn-copy {
            padding: 8px 16px;
            background: #f7931a;
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-copy:hover {
            background: #ff9900;
            transform: scale(1.05);
        }

        .payment-steps {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .step-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: flex-start;
        }

        .step-item:last-child {
            margin-bottom: 0;
        }

        .step-number {
            width: 30px;
            height: 30px;
            background: #f7931a;
            color: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: #fff;
            margin-bottom: 5px;
        }

        .step-content p {
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .contact-info {
            text-align: center;
            padding: 20px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 15px;
            border: 1px solid rgba(255, 153, 0, 0.2);
        }

        .contact-info p {
            color: #cbd5e0;
            margin-bottom: 10px;
        }

        .contact-info strong {
            color: #f7931a;
            font-size: 1.1rem;
        }

        /* 顶部导航栏 */
        .header {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-btc-logo {
            font-size: 2.5rem;
        }

        .header-text h2 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            padding: 6px 12px;
            background: rgba(247, 147, 26, 0.2);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #f7931a;
            font-weight: 600;
        }

        .vip-badge {
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            color: #000;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .expiry-info {
            color: #a0aec0;
            font-size: 0.85rem;
        }

        .btn-logout {
            padding: 8px 20px;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            color: #ef4444;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* 仪表盘 */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }

        .dashboard-card h3 {
            font-size: 0.9rem;
            color: #a0aec0;
            margin-bottom: 15px;
        }

        .dashboard-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .dashboard-value.positive {
            color: #10b981;
        }

        .dashboard-value.negative {
            color: #ef4444;
        }

        .dashboard-value.neutral {
            color: #f7931a;
        }

        .dashboard-change {
            font-size: 0.85rem;
            color: #a0aec0;
        }

        .update-time {
            text-align: center;
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            margin-bottom: 20px;
            color: #a0aec0;
        }

        .update-time strong {
            color: #f7931a;
        }

        /* 雷达图 */
        .radar-container {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .radar-container h3 {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #f7931a;
        }

        /* 指标区域 */
        .indicators-section {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding: 10px 20px;
            background: rgba(247, 147, 26, 0.1);
            border-left: 4px solid #f7931a;
            border-radius: 8px;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .indicator-card {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .indicator-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.15);
            border-color: #f7931a;
        }

        .indicator-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #f7931a;
        }

        .indicator-value {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .indicator-value.bullish {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            color: #10b981;
        }

        .indicator-value.neutral {
            background: rgba(107, 114, 128, 0.2);
            border: 2px solid #6b7280;
            color: #6b7280;
        }

        .indicator-value.bearish {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            color: #ef4444;
        }

        /* 管理员界面 */
        .admin-panel {
            background: rgba(21, 25, 50, 0.8);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid rgba(255, 153, 0, 0.2);
        }

        .admin-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #a0aec0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .admin-tab.active {
            color: #f7931a;
            border-bottom-color: #f7931a;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .indicator-buttons {
            display: flex;
            gap: 10px;
        }

        .indicator-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
        }

        .indicator-btn.bullish {
            border-color: #10b981;
            color: #10b981;
        }

        .indicator-btn.bullish:hover,
        .indicator-btn.bullish.active {
            background: #10b981;
            color: #ffffff;
        }

        .indicator-btn.neutral {
            border-color: #6b7280;
            color: #6b7280;
        }

        .indicator-btn.neutral:hover,
        .indicator-btn.neutral.active {
            background: #6b7280;
            color: #ffffff;
        }

        .indicator-btn.bearish {
            border-color: #ef4444;
            color: #ef4444;
        }

        .indicator-btn.bearish:hover,
        .indicator-btn.bearish.active {
            background: #ef4444;
            color: #ffffff;
        }

        .save-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            border: none;
            border-radius: 10px;
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(247, 147, 26, 0.4);
        }

        /* 会员管理 */
        .member-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-box {
            flex: 1;
            padding: 12px 16px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 153, 0, 0.2);
            border-radius: 10px;
            color: #ffffff;
        }

        .member-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }

        .member-table th {
            background: rgba(247, 147, 26, 0.2);
            padding: 15px;
            text-align: left;
            color: #f7931a;
            font-weight: 600;
        }

        .member-table td {
            padding: 15px;
            border-top: 1px solid rgba(255, 153, 0, 0.1);
            color: #cbd5e0;
        }

        .member-table tr:hover {
            background: rgba(247, 147, 26, 0.05);
        }

        .status-active {
            color: #10b981;
            font-weight: 600;
        }

        .status-expired {
            color: #ef4444;
            font-weight: 600;
        }

        .status-trial {
            color: #10b981;
            font-weight: 600;
        }

        .trial-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .renewal-reminder {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
            z-index: 9999;
            max-width: 350px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }


        .status-pending {
            color: #f59e0b;
            font-weight: 600;
        }

        .btn-small {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            margin-right: 5px;
            transition: all 0.3s;
        }

        .btn-edit {
            background: #3b82f6;
            color: white;
        }

        .btn-edit:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(21, 25, 50, 0.95);
            border: 1px solid rgba(255, 153, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            backdrop-filter: blur(10px);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #f7931a;
            font-size: 1.5rem;
        }

        .btn-close {
            background: none;
            border: none;
            color: #a0aec0;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .btn-close:hover {
            color: #ef4444;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-cancel {
            padding: 10px 20px;
            background: rgba(107, 114, 128, 0.3);
            border: 1px solid rgba(107, 114, 128, 0.5);
            border-radius: 8px;
            color: #cbd5e0;
            cursor: pointer;
        }

        .btn-confirm {
            padding: 10px 20px;
            background: linear-gradient(135deg, #f7931a 0%, #ff9900 100%);
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-weight: 600;
            cursor: pointer;
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .radio-option {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border: 2px solid rgba(255, 153, 0, 0.2);
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .radio-option:hover {
            border-color: #f7931a;
        }

        .radio-option.selected {
            border-color: #f7931a;
            background: rgba(247, 147, 26, 0.2);
        }

        .radio-option input {
            display: none;
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }

            .pricing-grid {
                grid-template-columns: 1fr;
            }

            .indicators-grid {
                grid-template-columns: 1fr;
            }

            .admin-tabs {
                flex-direction: column;
            }

            .member-controls {
                flex-direction: column;
            }

            .member-table {
                font-size: 0.85rem;
            }

            .member-table th,
            .member-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- 登录界面 -->
    <div id="loginContainer" class="container">
        <div class="login-box">
            <div class="btc-logo">₿</div>
            <h1>BTC综合指标系统</h1>
            <p class="subtitle">付费订阅版 - 专业投研服务</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">邮箱地址</label>
                    <input type="email" id="email" placeholder="请输入邮箱" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" placeholder="至少6位字符" required>
                </div>
                <button type="submit" class="btn btn-primary">登录</button>
                <button type="button" id="registerBtn" class="btn btn-secondary">注册新账号</button>
            </form>
        </div>
    </div>

    <!-- 付费页面 -->
    <div id="paymentContainer" class="container hidden">
        <div class="payment-page">
            <div class="payment-card">
                <div class="payment-header">
                    <div class="btc-logo">₿</div>
                    <h2>欢迎订阅 BTC 综合指标系统</h2>
                    <p>专业投研团队每日更新 · 20项核心指标 · 多维度量化分析</p>
                </div>

                <!-- 免费试用横幅 -->
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); 
                            padding: 20px; 
                            border-radius: 15px; 
                            text-align: center; 
                            margin-bottom: 20px;
                            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
                            animation: pulse 2s infinite;">
                    <h3 style="color: #fff; font-size: 1.5rem; margin-bottom: 10px;">
                        🎁 新用户福利：免费试用 7 天！
                    </h3>
                    <p style="color: rgba(255,255,255,0.9); font-size: 1rem;">
                        无需付费，注册即可体验全部功能 · 满意后随时升级
                    </p>
                </div>


                
                <!-- 试用结束提示 -->
                <div style="background: rgba(16, 185, 129, 0.1); 
                            border: 2px solid #10b981; 
                            border-radius: 10px; 
                            padding: 15px; 
                            text-align: center; 
                            margin-bottom: 20px;">
                    <p style="color: #10b981; font-size: 1.1rem; font-weight: 600;">
                        ✨ 试用结束后，选择以下套餐继续使用
                    </p>
                </div>

                <div class="pricing-grid">
                    <div class="pricing-item">
                        <div class="pricing-title">月度会员</div>
                        <div class="pricing-price">29<span style="font-size: 1rem;"> USDT</span></div>
                        <div class="pricing-period">每月</div>
                    </div>

                    <div class="pricing-item recommended">
                        <div class="pricing-badge">推荐</div>
                        <div class="pricing-title">季度会员</div>
                        <div class="pricing-price">59<span style="font-size: 1rem;"> USDT</span></div>
                        <div class="pricing-period">3个月</div>
                        <div class="pricing-save">省 28 USDT</div>
                    </div>

                    <div class="pricing-item">
                        <div class="pricing-title">年度会员</div>
                        <div class="pricing-price">199<span style="font-size: 1rem;"> USDT</span></div>
                        <div class="pricing-period">12个月</div>
                        <div class="pricing-save">省 149 USDT</div>
                    </div>
                </div>

                <div class="wallet-section">
                    <div class="wallet-title">💰 BSC链 USDT 收款地址</div>
                    <div class="wallet-address">
                        <input type="text" id="walletAddress" value="0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb" readonly>
                        <button class="btn-copy" onclick="copyWallet()">复制</button>
                    </div>
                    <p style="color: #a0aec0; font-size: 0.85rem; margin-top: 10px;">
                        ⚠️ 请务必使用 <strong style="color: #f7931a;">BSC链（币安智能链）</strong> 转账 USDT
                    </p>
                </div>

                <div class="payment-steps">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>复制钱包地址</h4>
                            <p>点击上方"复制"按钮，复制BSC链USDT收款地址</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>转账对应金额</h4>
                            <p>使用钱包转账对应套餐的USDT金额到收款地址</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>截图转账记录</h4>
                            <p>转账完成后，截图保存交易记录</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>联系客服激活</h4>
                            <p>发送截图 + 注册邮箱给客服，等待激活</p>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h4>开始使用</h4>
                            <p>激活后刷新页面即可查看专业指标分析</p>
                        </div>
                    </div>
                </div>

                <div class="contact-info">
                    <p>💬 客服联系方式</p>
                    <p><strong>微信：YourWeChatID</strong></p>
                    <p><strong>Telegram：@YourTelegramID</strong></p>
                    <p style="margin-top: 15px; font-size: 0.85rem; color: #a0aec0;">
                        激活通常在10分钟内完成<br>
                        遇到问题请联系客服
                    </p>
                </div>
            </div>

            <div style="text-align: center; padding: 20px;">
                <button class="btn-logout" onclick="firebase.auth().signOut()">退出登录</button>
            </div>
        </div>
    </div>

    <!-- 会员查看页面 -->
    <div id="memberContainer" class="container hidden">
        <!-- 顶部导航栏 -->
        <div class="header">
            <div class="header-title">
                <div class="header-btc-logo">₿</div>
                <div class="header-text">
                    <h2>BTC综合指标系统</h2>
                    <p style="color: #a0aec0; font-size: 0.9rem;">专业投研 · 会员专享</p>
                </div>
            </div>
            <div class="user-info">
                <span id="memberEmail" style="color: #cbd5e0;"></span>
                <span class="vip-badge">💎 VIP会员</span>
                <span id="memberExpiry" class="expiry-info"></span>
                <button id="memberLogoutBtn" class="btn-logout">退出</button>
            </div>
        </div>

        <div class="update-time">
            <strong>📅 数据更新时间：</strong><span id="updateTime">加载中...</span>
        </div>

        <!-- 仪表盘 -->
        <div class="dashboard">
            <div class="dashboard-card">
                <h3>BTC 当前价格</h3>
                <div id="btcPrice" class="dashboard-value neutral">加载中...</div>
                <div id="btcChange" class="dashboard-change">24h 涨跌: --</div>
            </div>
            <div class="dashboard-card">
                <h3>综合得分</h3>
                <div id="totalScore" class="dashboard-value neutral">0</div>
                <div class="dashboard-change">范围: -20 ~ +20</div>
            </div>
            <div class="dashboard-card">
                <h3>看多指标</h3>
                <div id="bullishCount" class="dashboard-value positive">0</div>
                <div class="dashboard-change">个</div>
            </div>
            <div class="dashboard-card">
                <h3>看空指标</h3>
                <div id="bearishCount" class="dashboard-value negative">0</div>
                <div class="dashboard-change">个</div>
            </div>
        </div>

        <!-- 雷达图 -->
        <div class="radar-container">
            <h3>₿ 多维度分析雷达图</h3>
            <canvas id="memberRadarChart"></canvas>
        </div>

        <!-- 指标区域（只读显示） -->
        <div class="indicators-section">
            <h3 class="category-title">📊 技术指标 (5项)</h3>
            <div id="memberTechnicalIndicators" class="indicators-grid"></div>

            <h3 class="category-title">💰 资金面 (5项)</h3>
            <div id="memberFundingIndicators" class="indicators-grid"></div>

            <h3 class="category-title">⛓️ 链上数据 (5项)</h3>
            <div id="memberOnchainIndicators" class="indicators-grid"></div>

            <h3 class="category-title">😊 市场情绪 (5项)</h3>
            <div id="memberSentimentIndicators" class="indicators-grid"></div>
        </div>
    </div>

    <!-- 管理员界面 -->
    <div id="adminContainer" class="container hidden">
        <!-- 顶部导航栏 -->
        <div class="header">
            <div class="header-title">
                <div class="header-btc-logo">₿</div>
                <div class="header-text">
                    <h2>管理员控制面板</h2>
                    <p style="color: #a0aec0; font-size: 0.9rem;">BTC综合指标系统</p>
                </div>
            </div>
            <div class="user-info">
                <span id="adminEmail" style="color: #cbd5e0;"></span>
                <span class="user-badge">🔧 超级管理员</span>
                <button id="adminLogoutBtn" class="btn-logout">退出</button>
            </div>
        </div>

        <div class="admin-panel">
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('update')">更新指标</button>
                <button class="admin-tab" onclick="switchAdminTab('members')">会员管理</button>
            </div>

            <!-- 更新指标标签页 -->
            <div id="adminUpdateTab" class="admin-content active">
                <div class="update-time" style="margin-bottom: 20px;">
                    <strong>当前综合得分：</strong><span id="adminTotalScore">0</span>
                </div>

                <div class="indicators-section">
                    <h3 class="category-title">📊 技术指标 (5项)</h3>
                    <div id="adminTechnicalIndicators" class="indicators-grid"></div>

                    <h3 class="category-title">💰 资金面 (5项)</h3>
                    <div id="adminFundingIndicators" class="indicators-grid"></div>

                    <h3 class="category-title">⛓️ 链上数据 (5项)</h3>
                    <div id="adminOnchainIndicators" class="indicators-grid"></div>

                    <h3 class="category-title">😊 市场情绪 (5项)</h3>
                    <div id="adminSentimentIndicators" class="indicators-grid"></div>
                </div>

                <button class="save-button" onclick="saveIndicators()">💾 保存并发布更新</button>
            </div>

            <!-- 会员管理标签页 -->
            <div id="adminMembersTab" class="admin-content">
                <div class="member-controls">
                    <input type="text" class="search-box" id="memberSearch" placeholder="搜索邮箱...">
                    <button class="btn btn-primary" style="width: auto; padding: 12px 30px;" onclick="showAddMemberModal()">
                        ➕ 添加会员
                    </button>
                </div>

                <div style="overflow-x: auto;">
                    <table class="member-table">
                        <thead>
                            <tr>
                                <th>邮箱</th>
                                <th>状态</th>
                                <th>订阅类型</th>
                                <th>到期时间</th>
                                <th>注册时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="memberTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center; color: #a0aec0;">加载中...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 20px; text-align: center; color: #a0aec0;">
                    总会员数：<strong id="totalMembers" style="color: #f7931a;">0</strong> |
                    活跃：<strong id="activeMembers" style="color: #10b981;">0</strong> |
                    过期：<strong id="expiredMembers" style="color: #ef4444;">0</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑会员模态框 -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">添加新会员</h3>
                <button class="btn-close" onclick="closeMemberModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>会员邮箱</label>
                    <input type="email" id="modalEmail" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label>订阅类型</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="subscriptionType" value="monthly" checked>
                            <div>月度会员</div>
                            <div style="color: #f7931a; font-size: 0.9rem;">1个月</div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="subscriptionType" value="quarterly">
                            <div>季度会员</div>
                            <div style="color: #f7931a; font-size: 0.9rem;">3个月</div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="subscriptionType" value="halfyearly">
                            <div>半年会员</div>
                            <div style="color: #f7931a; font-size: 0.9rem;">6个月</div>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="subscriptionType" value="yearly">
                            <div>年度会员</div>
                            <div style="color: #f7931a; font-size: 0.9rem;">12个月</div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>备注（可选）</label>
                    <input type="text" id="modalNote" placeholder="付款方式、交易ID等">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeMemberModal()">取消</button>
                <button class="btn-confirm" onclick="confirmAddMember()">确认激活</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyCLXQoE3uk78co1R-GzcY5myrzciZ0CmpM",
            authDomain: "btc-indicator2.firebaseapp.com",
            projectId: "btc-indicator2",
            storageBucket: "btc-indicator2.firebasestorage.app",
            messagingSenderId: "639218085696",
            appId: "1:639218085696:web:c09a09eb257267429e54a5"
        };

        // 初始化 Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 管理员邮箱（首个注册用户自动成为管理员）
        const ADMIN_EMAIL = 'b857455132@gmail.com'; // ✅ 已配置管理员邮箱 // 修改为你的管理员邮箱

        // 20个指标配置
        const indicators = {
            technical: [
                { id: 'macd', name: 'MACD' },
                { id: 'rsi', name: 'RSI' },
                { id: 'kdj', name: 'KDJ' },
                { id: 'boll', name: 'BOLL布林带' },
                { id: 'ma', name: 'MA均线' }
            ],
            funding: [
                { id: 'volume', name: '成交量' },
                { id: 'flow', name: '资金流向' },
                { id: 'chips', name: '筹码分布' },
                { id: 'obv', name: 'OBV能量潮' },
                { id: 'cci', name: 'CCI顺势指标' }
            ],
            onchain: [
                { id: 'addresses', name: '持币地址数' },
                { id: 'exchange_inflow', name: '交易所流入' },
                { id: 'exchange_outflow', name: '交易所流出' },
                { id: 'whale', name: '巨鲸持仓' },
                { id: 'activity', name: '链上活跃度' }
            ],
            sentiment: [
                { id: 'greed', name: '贪婪指数' },
                { id: 'fear', name: '恐慌指数' },
                { id: 'contract', name: '合约多空比' },
                { id: 'etf', name: 'ETF流入' },
                { id: 'social', name: '社交媒体热度' }
            ]
        };

        let currentScores = {};
        let currentUser = null;
        let radarChart = null;
        let editingMemberId = null;

        // 初始化所有指标为0
        Object.values(indicators).flat().forEach(ind => {
            currentScores[ind.id] = 0;
        });

        // 登录
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                alert('登录失败: ' + error.message);
            }
        });

        // 注册
        document.getElementById('registerBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                alert('请填写邮箱和密码');
                return;
            }

            if (password.length < 6) {
                alert('密码至少需要6位字符');
                return;
            }

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                
                // 检查是否为首个用户
                const usersSnapshot = await db.collection('users').get();
                const isFirstUser = usersSnapshot.empty;
                
                // 创建用户文档
                await db.collection('users').doc(userCredential.user.uid).set({
                    email: email,
                    role: isFirstUser || email === ADMIN_EMAIL ? 'admin' : 'user',
                    isPaid: false,
                    subscriptionType: null,
                    expiryDate: null,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert('注册成功！');
            } catch (error) {
                alert('注册失败: ' + error.message);
            }
        });

        // 退出登录
        document.getElementById('memberLogoutBtn').addEventListener('click', () => auth.signOut());
        document.getElementById('adminLogoutBtn').addEventListener('click', () => auth.signOut());

        // 监听登录状态
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                const userDocRef = db.collection('users').doc(user.uid);
                const userDoc = await userDocRef.get();
                
                if (!userDoc.exists) {
                    // 创建用户文档（新注册用户自动获得7天试用）
                    const isFirstUser = (await db.collection('users').get()).empty;
                    await userDocRef.set({
                        email: user.email,
                        role: isFirstUser || user.email === ADMIN_EMAIL ? 'admin' : 'user',
                        isPaid: true,  // 新用户自动试用
                        isTrial: true,
                        subscriptionType: 'trial',
                        expiryDate: firebase.firestore.Timestamp.fromDate(new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('🎉 注册成功！您已获得7天免费试用！');
                }

                let userData = userDoc.exists ? userDoc.data() : (await userDocRef.get()).data();
                
                // ✅ 关键修复：自动升级管理员权限
                if (user.email === ADMIN_EMAIL && (!userData || userData.role !== 'admin')) {
                    await userDocRef.update({ role: 'admin' });
                    userData.role = 'admin';
                }
                
                // 隐藏登录界面
                document.getElementById('loginContainer').classList.add('hidden');
                
                // ✅ 关键修复：优先检查管理员身份（邮箱或role）
                if (user.email === ADMIN_EMAIL || (userData && userData.role === 'admin')) {
                    // 显示管理员界面
                    showAdminInterface(user.email);
                } else if (userData && userData.isPaid && userData.expiryDate) {
                    // 检查是否过期
                    const expiryDate = userData.expiryDate.toDate();
                    if (expiryDate > new Date()) {
                        // 显示会员界面
                        showMemberInterface(user.email, expiryDate);
                    } else {
                        // 显示付费页面
                        showPaymentPage(user.email);
                    }
                } else {
                    // 显示付费页面
                    showPaymentPage(user.email);
                }
            } else {
                // 显示登录界面
                document.getElementById('loginContainer').classList.remove('hidden');
                document.getElementById('paymentContainer').classList.add('hidden');
                document.getElementById('memberContainer').classList.add('hidden');
                document.getElementById('adminContainer').classList.add('hidden');
            }
        });

        // 显示付费页面
        function showPaymentPage(email) {
            document.getElementById('paymentContainer').classList.remove('hidden');
            document.getElementById('memberContainer').classList.add('hidden');
            document.getElementById('adminContainer').classList.add('hidden');
        }

        // 显示会员界面
        async function showMemberInterface(email, expiryDate) {
            document.getElementById('paymentContainer').classList.add('hidden');
            document.getElementById('memberContainer').classList.remove('hidden');
            document.getElementById('adminContainer').classList.add('hidden');

            document.getElementById('memberEmail').textContent = email;
            
            // 获取用户数据判断是否试用
            const userDoc = await db.collection('users').doc(currentUser.uid).get();
            const userData = userDoc.data();
            
            // 计算剩余天数
            const now = new Date();
            const expiry = expiryDate.toDate();
            const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
            
            // 设置会员标识
            const badgeElement = document.querySelector('.vip-badge');
            if (userData && userData.isTrial) {
                badgeElement.textContent = `🎁 试用会员 (剩余${daysLeft}天)`;
                badgeElement.className = 'trial-badge';
            } else {
                badgeElement.textContent = '💎 VIP会员';
                badgeElement.className = 'vip-badge';
            }
            
            // 设置到期信息
            const expiryInfo = document.getElementById('memberExpiry');
            if (userData && userData.isTrial && daysLeft <= 3) {
                expiryInfo.innerHTML = `<span style="color: #f59e0b;">⚠️ 试用即将到期，剩余 ${daysLeft} 天</span>`;
                // 显示续费提醒
                showRenewalReminder(daysLeft);
            } else {
                expiryInfo.textContent = '到期: ' + expiryDate.toLocaleDateString('zh-CN');
            }

            // 加载最新指标数据
            await loadLatestIndicators(true);
            
            // 获取BTC价格
            fetchBTCPrice();
            setInterval(fetchBTCPrice, 30000);
        }

        // 显示管理员界面
        async function showAdminInterface(email) {
            document.getElementById('paymentContainer').classList.add('hidden');
            document.getElementById('memberContainer').classList.add('hidden');
            document.getElementById('adminContainer').classList.remove('hidden');

            document.getElementById('adminEmail').textContent = email;

            // 初始化管理员指标编辑界面
            initAdminIndicators();
            
            // 加载最新指标
            await loadLatestIndicators(false);
            
            // 加载会员列表
            loadMemberList();
        }

        // 初始化管理员指标编辑界面
        function initAdminIndicators() {
            const categories = [
                { id: 'adminTechnicalIndicators', data: indicators.technical },
                { id: 'adminFundingIndicators', data: indicators.funding },
                { id: 'adminOnchainIndicators', data: indicators.onchain },
                { id: 'adminSentimentIndicators', data: indicators.sentiment }
            ];

            categories.forEach(cat => {
                const container = document.getElementById(cat.id);
                container.innerHTML = '';
                
                cat.data.forEach(ind => {
                    const card = document.createElement('div');
                    card.className = 'indicator-card';
                    card.innerHTML = `
                        <div class="indicator-name">${ind.name}</div>
                        <div class="indicator-buttons">
                            <button class="indicator-btn bullish" data-id="${ind.id}" data-value="1">
                                看多 +1
                            </button>
                            <button class="indicator-btn neutral" data-id="${ind.id}" data-value="0">
                                中性 0
                            </button>
                            <button class="indicator-btn bearish" data-id="${ind.id}" data-value="-1">
                                看空 -1
                            </button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            });

            // 添加按钮点击事件
            document.querySelectorAll('.indicator-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = this.dataset.id;
                    const value = parseInt(this.dataset.value);
                    
                    currentScores[id] = value;
                    
                    this.parentElement.querySelectorAll('.indicator-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    updateAdminScore();
                });
            });
        }

        // 更新管理员综合得分显示
        function updateAdminScore() {
            const total = Object.values(currentScores).reduce((a, b) => a + b, 0);
            document.getElementById('adminTotalScore').textContent = total > 0 ? '+' + total : total;
        }

        // 加载最新指标数据
        async function loadLatestIndicators(isMemberView) {
            try {
                const snapshot = await db.collection('indicators')
                    .orderBy('timestamp', 'desc')
                    .limit(1)
                    .get();

                if (!snapshot.empty) {
                    const data = snapshot.docs[0].data();
                    currentScores = data.scores || {};
                    
                    if (isMemberView) {
                        // 显示会员只读界面
                        displayMemberIndicators();
                        updateMemberDashboard();
                        initMemberRadarChart();
                        
                        // 显示更新时间
                        if (data.timestamp) {
                            const updateTime = data.timestamp.toDate().toLocaleString('zh-CN');
                            document.getElementById('updateTime').textContent = updateTime;
                        }
                    } else {
                        // 恢复管理员编辑状态
                        Object.entries(currentScores).forEach(([id, value]) => {
                            const btns = document.querySelectorAll(`[data-id="${id}"]`);
                            btns.forEach(btn => {
                                btn.classList.remove('active');
                                if (parseInt(btn.dataset.value) === value) {
                                    btn.classList.add('active');
                                }
                            });
                        });
                        updateAdminScore();
                    }
                }
            } catch (error) {
                console.error('加载指标失败:', error);
            }
        }

        // 显示会员只读指标
        function displayMemberIndicators() {
            const categories = [
                { id: 'memberTechnicalIndicators', data: indicators.technical },
                { id: 'memberFundingIndicators', data: indicators.funding },
                { id: 'memberOnchainIndicators', data: indicators.onchain },
                { id: 'memberSentimentIndicators', data: indicators.sentiment }
            ];

            categories.forEach(cat => {
                const container = document.getElementById(cat.id);
                container.innerHTML = '';
                
                cat.data.forEach(ind => {
                    const value = currentScores[ind.id] || 0;
                    const valueClass = value > 0 ? 'bullish' : value < 0 ? 'bearish' : 'neutral';
                    const valueText = value > 0 ? '看多 +1' : value < 0 ? '看空 -1' : '中性 0';
                    
                    const card = document.createElement('div');
                    card.className = 'indicator-card';
                    card.innerHTML = `
                        <div class="indicator-name">${ind.name}</div>
                        <div class="indicator-value ${valueClass}">${valueText}</div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        // 更新会员仪表盘
        function updateMemberDashboard() {
            const scores = Object.values(currentScores);
            const total = scores.reduce((a, b) => a + b, 0);
            const bullish = scores.filter(s => s > 0).length;
            const bearish = scores.filter(s => s < 0).length;

            const totalEl = document.getElementById('totalScore');
            totalEl.textContent = total > 0 ? '+' + total : total;
            totalEl.className = 'dashboard-value ' + 
                (total > 0 ? 'positive' : total < 0 ? 'negative' : 'neutral');

            document.getElementById('bullishCount').textContent = bullish;
            document.getElementById('bearishCount').textContent = bearish;
        }

        // 初始化会员雷达图
        function initMemberRadarChart() {
            const ctx = document.getElementById('memberRadarChart').getContext('2d');
            
            if (radarChart) {
                radarChart.destroy();
            }

            const technical = indicators.technical.reduce((sum, ind) => sum + (currentScores[ind.id] || 0), 0);
            const funding = indicators.funding.reduce((sum, ind) => sum + (currentScores[ind.id] || 0), 0);
            const onchain = indicators.onchain.reduce((sum, ind) => sum + (currentScores[ind.id] || 0), 0);
            const sentiment = indicators.sentiment.reduce((sum, ind) => sum + (currentScores[ind.id] || 0), 0);
            const total = Object.values(currentScores).reduce((a, b) => a + b, 0);

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['技术指标', '资金面', '链上数据', '市场情绪', '综合评分'],
                    datasets: [{
                        label: '当前评分',
                        data: [technical, funding, onchain, sentiment, total / 4],
                        backgroundColor: 'rgba(247, 147, 26, 0.2)',
                        borderColor: 'rgba(247, 147, 26, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(247, 147, 26, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(247, 147, 26, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            min: -5,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                color: '#a0aec0'
                            },
                            grid: {
                                color: 'rgba(255, 153, 0, 0.1)'
                            },
                            pointLabels: {
                                color: '#f7931a',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#cbd5e0'
                            }
                        }
                    }
                }
            });
        }

        // 获取BTC价格
        async function fetchBTCPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const data = await response.json();
                
                const price = data.bitcoin.usd;
                const change = data.bitcoin.usd_24h_change;
                
                document.getElementById('btcPrice').textContent = '$' + price.toLocaleString();
                
                const changeEl = document.getElementById('btcChange');
                changeEl.textContent = `24h 涨跌: ${change >= 0 ? '+' : ''}${change.toFixed(2)}%`;
                changeEl.style.color = change >= 0 ? '#10b981' : '#ef4444';
            } catch (error) {
                console.error('获取BTC价格失败:', error);
            }
        }

        // 保存指标（管理员）
        async function saveIndicators() {
            if (!currentUser) return;

            try {
                const total = Object.values(currentScores).reduce((a, b) => a + b, 0);
                
                await db.collection('indicators').add({
                    scores: currentScores,
                    totalScore: total,
                    updatedBy: currentUser.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert('✅ 指标已保存并发布！所有会员可见最新数据。');
            } catch (error) {
                alert('保存失败: ' + error.message);
            }
        }

        // 切换管理员标签页
        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            
            if (tab === 'update') {
                document.querySelector('[onclick="switchAdminTab(\'update\')"]').classList.add('active');
                document.getElementById('adminUpdateTab').classList.add('active');
            } else if (tab === 'members') {
                document.querySelector('[onclick="switchAdminTab(\'members\')"]').classList.add('active');
                document.getElementById('adminMembersTab').classList.add('active');
                loadMemberList();
            }
        }

        // 加载会员列表
        async function loadMemberList() {
            try {
                const snapshot = await db.collection('users')
                    .where('role', '==', 'user')
                    .get();

                const tbody = document.getElementById('memberTableBody');
                tbody.innerHTML = '';

                let totalCount = 0;
                let activeCount = 0;
                let expiredCount = 0;

                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #a0aec0;">暂无会员</td></tr>';
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const row = document.createElement('tr');
                        
                        totalCount++;
                        
                        let status = '未激活';
                        let statusClass = 'status-pending';
                        
                        if (data.isPaid && data.expiryDate) {
                            const expiryDate = data.expiryDate.toDate();
                            if (expiryDate > new Date()) {
                                status = '✅ 已激活';
                                statusClass = 'status-active';
                                activeCount++;
                            } else {
                                status = '⏰ 已过期';
                                statusClass = 'status-expired';
                                expiredCount++;
                            }
                        }

                        const subscriptionType = data.subscriptionType ? 
                            {
                                'monthly': '月度会员',
                                'quarterly': '季度会员',
                                'halfyearly': '半年会员',
                                'yearly': '年度会员'
                            }[data.subscriptionType] : '-';

                        const expiryDateStr = data.expiryDate ? 
                            data.expiryDate.toDate().toLocaleDateString('zh-CN') : '-';

                        const createdAtStr = data.createdAt ? 
                            data.createdAt.toDate().toLocaleDateString('zh-CN') : '-';

                        row.innerHTML = `
                            <td>${data.email}</td>
                            <td><span class="${statusClass}">${status}</span></td>
                            <td>${subscriptionType}</td>
                            <td>${expiryDateStr}</td>
                            <td>${createdAtStr}</td>
                            <td>
                                <button class="btn-small btn-edit" onclick="editMember('${doc.id}')">编辑</button>
                                <button class="btn-small btn-delete" onclick="deleteMember('${doc.id}', '${data.email}')">删除</button>
                            </td>
                        `;
                        
                        tbody.appendChild(row);
                    });
                }

                document.getElementById('totalMembers').textContent = totalCount;
                document.getElementById('activeMembers').textContent = activeCount;
                document.getElementById('expiredMembers').textContent = expiredCount;

            } catch (error) {
                console.error('加载会员列表失败:', error);
            }
        }

        // 显示添加会员模态框
        function showAddMemberModal() {
            editingMemberId = null;
            document.getElementById('modalTitle').textContent = '添加新会员';
            document.getElementById('modalEmail').value = '';
            document.getElementById('modalEmail').readOnly = false;
            document.getElementById('modalNote').value = '';
            document.querySelectorAll('input[name="subscriptionType"]')[0].checked = true;
            document.getElementById('memberModal').classList.add('active');
        }

        // 编辑会员
        async function editMember(memberId) {
            try {
                const doc = await db.collection('users').doc(memberId).get();
                const data = doc.data();
                
                editingMemberId = memberId;
                document.getElementById('modalTitle').textContent = '编辑会员信息';
                document.getElementById('modalEmail').value = data.email;
                document.getElementById('modalEmail').readOnly = true;
                
                if (data.subscriptionType) {
                    document.querySelector(`input[name="subscriptionType"][value="${data.subscriptionType}"]`).checked = true;
                }
                
                document.getElementById('memberModal').classList.add('active');
            } catch (error) {
                alert('加载会员信息失败: ' + error.message);
            }
        }

        // 删除会员
        async function deleteMember(memberId, email) {
            if (!confirm(`确定要删除会员 ${email} 吗？此操作不可恢复。`)) {
                return;
            }

            try {
                await db.collection('users').doc(memberId).delete();
                alert('✅ 会员已删除');
                loadMemberList();
            } catch (error) {
                alert('删除失败: ' + error.message);
            }
        }

        // 关闭模态框
        function closeMemberModal() {
            document.getElementById('memberModal').classList.remove('active');
        }

        // 确认添加/编辑会员
        async function confirmAddMember() {
            const email = document.getElementById('modalEmail').value;
            const subscriptionType = document.querySelector('input[name="subscriptionType"]:checked').value;
            const note = document.getElementById('modalNote').value;

            if (!email) {
                alert('请输入邮箱');
                return;
            }

            // 计算到期时间
            const now = new Date();
            const expiryDate = new Date(now);
            switch (subscriptionType) {
                case 'monthly':
                    expiryDate.setMonth(expiryDate.getMonth() + 1);
                    break;
                case 'quarterly':
                    expiryDate.setMonth(expiryDate.getMonth() + 3);
                    break;
                case 'halfyearly':
                    expiryDate.setMonth(expiryDate.getMonth() + 6);
                    break;
                case 'yearly':
                    expiryDate.setFullYear(expiryDate.getFullYear() + 1);
                    break;
            }

            try {
                if (editingMemberId) {
                    // 更新现有会员
                    await db.collection('users').doc(editingMemberId).update({
                        isPaid: true,
                        subscriptionType: subscriptionType,
                        expiryDate: firebase.firestore.Timestamp.fromDate(expiryDate),
                        note: note,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('✅ 会员信息已更新！');
                } else {
                    // 查找用户
                    const snapshot = await db.collection('users').where('email', '==', email).get();
                    
                    if (snapshot.empty) {
                        alert('❌ 该邮箱尚未注册，请让用户先注册账号。');
                        return;
                    }

                    const userId = snapshot.docs[0].id;
                    
                    // 激活会员
                    await db.collection('users').doc(userId).update({
                        isPaid: true,
                        subscriptionType: subscriptionType,
                        expiryDate: firebase.firestore.Timestamp.fromDate(expiryDate),
                        note: note,
                        activatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    alert('✅ 会员已激活！用户刷新页面即可使用。');
                }

                closeMemberModal();
                loadMemberList();
            } catch (error) {
                alert('操作失败: ' + error.message);
            }
        }

        // 复制钱包地址
        function copyWallet() {
            const walletInput = document.getElementById('walletAddress');
            walletInput.select();
            document.execCommand('copy');
            
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '✓ 已复制';
            btn.style.background = '#10b981';
            
            setTimeout(() => {
                btn.textContent = originalText;
                btn.style.background = '#f7931a';
            }, 2000);
        }

        // 单选框样式
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.radio-option').forEach(o => o.classList.remove('selected'));
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                });
            });
        });

        // 显示续费提醒函数
        function showRenewalReminder(daysLeft) {
            const reminder = document.createElement('div');
            reminder.className = 'renewal-reminder';
            reminder.innerHTML = `
                <h4 style="color: #fff; margin-bottom: 10px; font-size: 1.1rem;">⏰ 试用即将到期</h4>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px; line-height: 1.5;">
                    您的免费试用还剩 <strong>${daysLeft}</strong> 天<br>
                    立即续费，继续享受专业投研服务！
                </p>
                <button onclick="alert('请添加客服微信续费：YourWeChatID\\n或 Telegram: @YourTelegramID')" 
                        style="width: 100%; padding: 12px; background: #fff; color: #d97706; 
                               border: none; border-radius: 8px; font-weight: 600; 
                               cursor: pointer; font-size: 1rem;">
                    立即续费
                </button>
                <button onclick="this.parentElement.remove()" 
                        style="width: 100%; padding: 8px; background: transparent; color: rgba(255,255,255,0.7); 
                               border: none; margin-top: 8px; cursor: pointer; font-size: 0.9rem;">
                    稍后提醒
                </button>
            `;
            document.body.appendChild(reminder);
        }

    </script>
</body>
</html>